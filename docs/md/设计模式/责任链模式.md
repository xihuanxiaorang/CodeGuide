---
title: è´£ä»»é“¾æ¨¡å¼
tags:
  - è®¾è®¡æ¨¡å¼ 
created: 2022-10-14 18:08:03
modified: 2022-10-17 07:05:02
number headings: auto, first-level 1, max 6, _.1.1.
---

# è´£ä»»é“¾æ¨¡å¼

## 1. ğŸ¨æ„å›¾

**è´£ä»»é“¾æ¨¡å¼** æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå…è®¸ä½ å°†è¯·æ±‚æ²¿ç€å¤„ç†è€…é“¾è¿›è¡Œå‘é€ã€‚æ”¶åˆ°è¯·æ±‚åï¼Œæ¯ä¸ªå¤„ç†è€…å‡å¯å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæˆ–å°†å…¶ä¼ é€’ç»™é“¾ä¸Šçš„ä¸‹ä¸ªå¤„ç†è€…ã€‚  
![||640](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211132359328.png)

## 2. ğŸ™é—®é¢˜

å‡å¦‚ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåœ¨çº¿è®¢è´­ç³»ç»Ÿã€‚ä½ å¸Œæœ›å¯¹ç³»ç»Ÿè®¿é—®è¿›è¡Œé™åˆ¶ï¼Œåªå…è®¸è®¤è¯ç”¨æˆ·åˆ›å»ºè®¢å•ã€‚æ­¤å¤–ï¼Œæ‹¥æœ‰ç®¡ç†æƒé™çš„ç”¨æˆ·ä¹Ÿæ‹¥æœ‰æ‰€æœ‰è®¢å•çš„å®Œå…¨è®¿é—®æƒé™ã€‚  
ç®€å•è§„åˆ’åï¼Œä½ ä¼šæ„è¯†åˆ°è¿™äº›ç®€å•å¿…é¡»ä¾æ¬¡è¿›è¡Œã€‚åªè¦æ”¶åˆ°åŒ…å«ç”¨æˆ·å‡­æ®çš„è¯·æ±‚ï¼Œåº”ç”¨ç¨‹åºå°±å¯å°è¯•å¯¹è¿›å…¥ç³»ç»Ÿçš„ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚ä½†å¦‚æœç”±äºç”¨æˆ·å‡­æ®ä¸æ­£ç¡®è€Œå¯¼è‡´è®¤è¯å¤±è´¥ï¼Œé‚£å°±æ²¡æœ‰æ¯”è¦è¿›è¡Œåç»­æ£€æŸ¥äº†ã€‚  
![è¯·æ±‚å¿…é¡»ç»è¿‡ä¸€ç³»åˆ—æ£€æŸ¥åæ‰èƒ½ç”±è®¢è´­ç³»ç»Ÿæ¥å¤„ç†|600](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211132359492.png)  
åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œï¼Œä½ å®ç°äº†åç»­çš„å‡ ä¸ªæ£€æŸ¥æ­¥éª¤ã€‚

- ä¸€ä½åŒäº‹è®¤ä¸ºç›´æ¥å°†åŸå§‹æ•°æ®ä¼ é€’ç»™è®¢è´­ç³»ç»Ÿå­˜åœ¨å®‰å…¨éšæ‚£ã€‚å› æ­¤ä½ æ–°å¢äº†é¢å¤–çš„éªŒè¯æ­¥éª¤æ¥æ¸…ç†è¯·æ±‚ä¸­çš„æ•°æ®ã€‚
- è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰äººæ³¨æ„åˆ°ç³»ç»Ÿæ— æ³•æŠµå¾¡æš´åŠ›å¯†ç ç ´è§£æ–¹æ³•çš„æ”»å‡»ã€‚ä¸ºäº†é˜²èŒƒè¿™ç§æƒ…å†µï¼Œä½ ç«‹åˆ»æ·»åŠ äº†ä¸€ä¸ªæ£€æŸ¥æ­¥éª¤æ¥è¿‡æ»¤æ¥è‡ªåŒä¸€ IP åœ°å€çš„é‡å¤é”™è¯¯è¯·æ±‚ã€‚
- åˆæœ‰äººæè®®ä½ å¯ä»¥å¯¹åŒ…å«åŒæ ·æ•°æ®çš„é‡å¤è¯·æ±‚è¿”å›ç¼“å­˜çš„ç»“æœï¼Œä»è€Œæé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚å› æ­¤ï¼Œä½ æ–°å¢äº†ä¸€ä¸ªæ£€æŸ¥æ­¥éª¤ï¼Œç¡®ä¿åªæœ‰æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„ç¼“å­˜ç»“æœæ—¶æ‰èƒ½é€šè¿‡å¹¶è¢«å‘é€ç»™ç³»ç»Ÿã€‚  
![ä»£ç å˜å¾—è¶Šæ¥è¶Šå¤šï¼ŒÂ ä¹Ÿè¶Šæ¥è¶Šæ··ä¹±|610](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211140008837.png)  
æ£€æŸ¥ä»£ç æœ¬æ¥å°±å·²ç»æ··ä¹±ä¸å ªï¼Œè€Œæ¯æ¬¡æ–°å¢åŠŸèƒ½éƒ½ä¼šä½¿å…¶æ›´åŠ è‡ƒè‚¿ã€‚ä¿®æ”¹æŸä¸ªæ£€æŸ¥æ­¥éª¤æœ‰æ—¶ä¼šå½±å“å…¶ä»–çš„æ£€æŸ¥æ­¥éª¤ã€‚æœ€ç³Ÿç³•çš„æ˜¯ï¼Œå½“ä½ å¸Œæœ›å¤ç”¨è¿™äº›æ£€æŸ¥æ­¥éª¤æ¥ä¿æŠ¤å…¶ä»–ç³»ç»Ÿç»„ä»¶æ—¶ï¼Œä½ åªèƒ½å¤åˆ¶éƒ¨åˆ†ä»£ç ï¼Œå› ä¸ºè¿™äº›ç»„ä»¶åªéœ€éƒ¨åˆ†è€Œéå…¨éƒ¨çš„æ£€æŸ¥æ­¥éª¤ã€‚  
ç³»ç»Ÿä¼šå˜å¾—è®©äººéå¸¸è´¹è§£ï¼Œè€Œä¸”å…¶ç»´æŠ¤æˆæœ¬ä¹Ÿä¼šæ¿€å¢ã€‚ä½ åœ¨è‰°éš¾åœ°å’Œè¿™äº›ä»£ç å…±å¤„ä¸€æ®µæ—¶é—´åï¼Œæœ‰ä¸€å¤©ç»ˆäºå†³å®šå¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œé‡æ„ã€‚

## 3. ğŸ¥³è§£å†³æ–¹æ¡ˆ

ä¸å…¶ä»–è¡Œä¸ºè®¾è®¡æ¨¡å¼ä¸€æ ·ï¼Œ**è´£ä»»é“¾** ä¼šå°†ç‰¹å®šè¡Œä¸ºè½¬æ¢ä¸ºè¢«ç§°ä½œ **å¤„ç†è€…** çš„ç‹¬ç«‹å¯¹è±¡ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªæ£€æŸ¥æ­¥éª¤éƒ½å¯è¢«æŠ½å–ä¸ºä»…æœ‰å•ä¸ªæ–¹æ³•çš„ç±»ï¼Œå¹¶æ‰§è¡Œæ£€æŸ¥æ“ä½œã€‚è¯·æ±‚åŠå…¶æ•°æ®åˆ™ä¼šè¢«ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ã€‚  
æ¨¡å¼å»ºè®®ä½ å°†è¿™äº›å¤„ç†è€…è¿æˆä¸€æ¡é“¾ã€‚**é“¾ä¸Šçš„æ¯ä¸ªå¤„ç†è€…éƒ½æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡æ¥ä¿å­˜å¯¹äºä¸‹ä¸€ä¸ªå¤„ç†è€…çš„å¼•ç”¨**ã€‚é™¤äº†å¤„ç†è¯·æ±‚å¤–ï¼Œå¤„ç†è€…è¿˜è´Ÿè´£æ²¿ç€é“¾ä¼ é€’è¯·æ±‚ã€‚è¯·æ±‚ä¼šåœ¨é“¾ä¸Šç§»åŠ¨ï¼Œç›´è‡³æ‰€æœ‰å¤„ç†è€…éƒ½æœ‰æœºä¼šå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚  
æœ€é‡è¦çš„æ˜¯ï¼šå¤„ç†è€…å¯ä»¥å†³å®šä¸å†æ²¿ç€é“¾ä¼ é€’è¯·æ±‚ï¼Œè¿™å¯é«˜æ•ˆåœ°å–æ¶ˆæ‰€æœ‰åç»­å¤„ç†æ­¥éª¤ã€‚  
åœ¨æˆ‘ä»¬åœ°è®¢è´­ç³»ç»Ÿç¤ºä¾‹ä¸­ï¼Œå¤„ç†è€…ä¼šåœ¨è¿›è¡Œå¤„ç†å·¥ä½œåå†³å®šæ˜¯å¦ç»§ç»­æ²¿ç€é“¾ä¼ é€’è¯·æ±‚ã€‚å¦‚æœè¯·æ±‚ä¸­åŒ…å«æ­£ç¡®çš„æ•°æ®ï¼Œæ‰€æœ‰å¤„ç†è€…éƒ½å°†æ‰§è¡Œè‡ªå·±çš„ä¸»è¦è¡Œä¸ºï¼Œæ— è®ºè¯¥è¡Œä¸ºæ˜¯èº«ä»½éªŒè¯è¿˜æ˜¯æ•°æ®ç¼“å­˜ã€‚  
![å¤„ç†è€…ä¾æ¬¡æ’åˆ—ï¼ŒÂ ç»„æˆä¸€æ¡é“¾|640](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211132359524.png)  
ä¸è¿‡è¿˜æœ‰ä¸€ç§ç¨å¾®ä¸åŒçš„æ–¹å¼ï¼ˆä¹Ÿæ˜¯æ›´ç»å…¸çš„ä¸€ç§ï¼‰ï¼Œé‚£å°±æ˜¯å¤„ç†è€…æ¥æ”¶åˆ°è¯·æ±‚åè‡ªè¡Œå†³å®šæ˜¯å¦èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœè‡ªå·±èƒ½å¤Ÿå¤„ç†ï¼Œå¤„ç†è€…å°±ä¸å†ç»§ç»­ä¼ é€’è¯·æ±‚ã€‚å› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯·æ±‚è¦ä¹ˆæœ€å¤šæœ‰ä¸€ä¸ªå¤„ç†è€…å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œè¦ä¹ˆæ²¡æœ‰ä»»ä½•å¤„ç†è€…å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚åœ¨å¤„ç†å›¾å½¢ç”¨æˆ·ç•Œé¢å…ƒç´ æ ˆä¸­çš„äº‹ä»¶æ—¶ï¼Œè¿™ç§æ–¹å¼éå¸¸å¸¸è§ã€‚  
ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼ŒæŒ‰é’®äº§ç”Ÿçš„äº‹ä»¶å°†æ²¿ç€ GUI å…ƒç´ é“¾è¿›è¡Œä¼ é€’ï¼Œæœ€å¼€å§‹æ˜¯æŒ‰é’®çš„å®¹å™¨ï¼ˆå¦‚çª—ä½“æˆ–é¢æ¿ï¼‰ï¼Œç›´è‡³åº”ç”¨ç¨‹åºä¸»çª—å£ã€‚é“¾ä¸Šç¬¬ä¸€ä¸ªèƒ½å¤„ç†è¯¥äº‹ä»¶çš„å…ƒç´ ä¼šå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚æ­¤å¤–ï¼Œè¯¥ä¾‹è¿˜æœ‰å¦ä¸€ä¸ªå€¼å¾—æˆ‘ä»¬å…³æ³¨çš„åœ°æ–¹ï¼šå®ƒè¡¨æ˜æˆ‘ä»¬æ€»ä»èƒ½å¯¹è±¡æ ‘ä¸­æŠ½å–å‡ºé“¾æ¥ã€‚  
![å¯¹è±¡æ ‘çš„æå¹²å¯ä»¥ç»„æˆä¸€æ¡é“¾|520](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211132359820.png)  
**æ‰€æœ‰å¤„ç†è€…ç±»å‡å¯å®ç°åŒä¸€æ¥å£æ˜¯å…³é”®æ‰€åœ¨**ã€‚æ¯ä¸ªå…·ä½“å¤„ç†è€…ä»…å…³å¿ƒä¸‹ä¸€ä¸ªåŒ…å« `execute` æ‰§è¡Œæ–¹æ³•çš„å¤„ç†è€…ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ å°±å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ä¸åŒçš„å¤„ç†è€…æ¥åˆ›å»ºé“¾ï¼Œè€Œæ— éœ€å°†ç›¸å…³ä»£ç ä¸å¤„ç†è€…çš„å…·ä½“ç±»è¿›è¡Œè€¦åˆã€‚

## 4. ğŸš—çœŸå®ä¸–ç•Œç±»æ¯”

![ç»™æŠ€æœ¯æ”¯æŒæ‰“ç”µè¯æ—¶ä½ å¯èƒ½å¾—åº”å¯¹å¤šåæ¥å¬äººå‘˜|600](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211132359639.png)  
æœ€è¿‘ï¼Œä½ åˆšä¸ºè‡ªå·±çš„ç”µè„‘è´­ä¹°å¹¶å®‰è£…äº†ä¸€ä¸ªæ–°çš„ç¡¬ä»¶è®¾å¤‡ã€‚èº«ä¸ºä¸€åæå®¢ï¼Œä½ æ˜¾ç„¶åœ¨ç”µè„‘ä¸Šå®‰è£…äº†å¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ä½ ä¼šè¯•ç€å¯åŠ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿæ¥ç¡®è®¤å…¶æ˜¯å¦æ”¯æŒæ–°çš„ç¡¬ä»¶è®¾å¤‡ã€‚Windows æ£€æµ‹åˆ°äº†è¯¥ç¡¬ä»¶è®¾å¤‡å¹¶å¯¹å…¶è¿›è¡Œäº†è‡ªåŠ¨å¯åŠ¨ã€‚ä½†æ˜¯ä½ å–œçˆ±çš„ Linux ç³»ç»Ÿå¹¶ä¸æ”¯æŒæ–°ç¡¬ä»¶è®¾å¤‡ã€‚æŠ±ç€æœ€åä¸€ç‚¹å¸Œæœ›ï¼Œä½ å†³å®šæ‹¨æ‰“åŒ…è£…ç›’ä¸Šçš„æŠ€æœ¯æ”¯æŒç”µè¯ã€‚  
é¦–å…ˆä½ ä¼šå¬åˆ°è‡ªåŠ¨å›å¤å™¨çš„æœºå™¨åˆæˆè¯­éŸ³ï¼Œå®ƒæä¾›äº†é’ˆå¯¹å„ç§é—®é¢˜çš„ä¹ä¸ªå¸¸ç”¨è§£å†³æ–¹æ¡ˆï¼Œä½†å…¶ä¸­æ²¡æœ‰ä¸€ä¸ªä¸ä½ é‡åˆ°çš„é—®é¢˜ç›¸å…³ã€‚è¿‡äº†ä¸€ä¼šå„¿ï¼Œæœºå™¨äººå°†ä½ è½¬æ¥åˆ°äººå·¥æ¥å¬äººå‘˜å¤„ã€‚  
è¿™ä½æ¥å¬äººå‘˜åŒæ ·æ— æ³•æä¾›ä»»ä½•å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚Â ä»–ä¸æ–­åœ°å¼•ç”¨æ‰‹å†Œä¸­å†—é•¿çš„å†…å®¹ï¼ŒÂ å¹¶ä¸ä¼šä»”ç»†è†å¬ä½ çš„å›åº”ã€‚Â åœ¨ç¬¬ 10 æ¬¡å¬åˆ°Â â€œä½ æ˜¯å¦å…³é—­è®¡ç®—æœºåé‡æ–°å¯åŠ¨å‘¢ï¼Ÿâ€Â è¿™å¥è¯åï¼ŒÂ ä½ è¦æ±‚ä¸ä¸€ä½çœŸæ­£çš„å·¥ç¨‹å¸ˆé€šè¯ã€‚  
æœ€åï¼ŒÂ æ¥å¬äººå‘˜å°†ä½ çš„ç”µè¯è½¬æ¥ç»™äº†å·¥ç¨‹å¸ˆï¼ŒÂ ä»–æˆ–è®¸æ­£ç¼©åœ¨æŸå¹¢åŠå…¬å¤§æ¥¼çš„é˜´æš—åœ°ä¸‹å®¤ä¸­ï¼ŒÂ ååœ¨ä»–æ‰€æ·±çˆ±çš„æœåŠ¡å™¨æœºæˆ¿é‡Œï¼ŒÂ ç„¦èºä¸å®‰åœ°æœŸå¾…ç€åŒä¸€åçœŸäººäº¤æµã€‚Â å·¥ç¨‹å¸ˆå‘Šè¯‰äº†ä½ æ–°ç¡¬ä»¶è®¾å¤‡é©±åŠ¨ç¨‹åºçš„ä¸‹è½½ç½‘å€ï¼ŒÂ ä»¥åŠå¦‚ä½•åœ¨ Linux ç³»ç»Ÿä¸Šè¿›è¡Œå®‰è£…ã€‚Â é—®é¢˜ç»ˆäºè§£å†³äº†ï¼Â ä½ æŒ‚æ–­äº†ç”µè¯ï¼ŒÂ æ»¡å¿ƒæ¬¢å–œã€‚

## 5. ğŸ¯ç»“æ„

![|380](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211132359852.png)

1. **å¤„ç†è€…**ï¼ˆHandlerï¼‰å£°æ˜äº†æ‰€æœ‰å…·ä½“å¤„ç†è€…çš„é€šç”¨æ¥å£ã€‚è¯¥æ¥å£é€šå¸¸ä»…åŒ…å«å•ä¸ªæ–¹æ³•ç”¨äºè¯·æ±‚å¤„ç†ï¼Œä½†æœ‰æ—¶å…¶è¿˜ä¼šåŒ…å«ä¸€ä¸ªè®¾ç½®é“¾ä¸Šä¸‹ä¸ªå¤„ç†è€…çš„æ–¹æ³•ã€‚
2. **åŸºç¡€å¤„ç†è€…**ï¼ˆBase Handlerï¼‰æ˜¯ä¸€ä¸ªå¯é€‰çš„ç±»ï¼Œä½ å¯ä»¥å°†æ‰€æœ‰å¤„ç†è€…å…±ç”¨çš„æ ·æœ¬ä»£ç æ”¾ç½®åœ¨å…¶ä¸­ã€‚é€šäº§æƒ…å†µä¸‹ï¼Œè¯¥ç±»ä¸­å®šä¹‰ä¸€ä¸ªä¿å­˜å¯¹äºä¸‹ä¸ªå¤„ç†è€…å¼•ç”¨çš„æˆå‘˜å˜é‡ã€‚å®¢æˆ·ç«¯å¯é€šè¿‡å°†å¤„ç†è€…ä¼ é€’ç»™ä¸Šä¸ªå¤„ç†è€…çš„æ„é€ å‡½æ•°æˆ–è®¾å®šæ–¹æ³•æ¥åˆ›å»ºé“¾ã€‚è¯¥ç±»è¿˜å¯ä»¥å®ç°é»˜è®¤çš„å¤„ç†è¡Œä¸ºï¼šç¡®å®šä¸‹ä¸ªå¤„ç†è€…å­˜åœ¨åå†å°†è¯·æ±‚ä¼ é€’ç»™å®ƒã€‚
3. **å…·ä½“å¤„ç†è€…**ï¼ˆConcrete Handlersï¼‰åŒ…å«å¤„ç†è¯·æ±‚çš„å®é™…ä»£ç ã€‚æ¯ä¸ªå¤„ç†è€…æ¥æ”¶åˆ°è¯·æ±‚åï¼Œéƒ½å¿…é¡»å†³å®šæ˜¯å¦è¿›è¡Œå¤„ç†ï¼Œä»¥åŠæ˜¯å¦æ²¿ç€é“¾ä¼ é€’è¯·æ±‚ã€‚å¤„ç†è€…é€šå¸¸æ˜¯ç‹¬ç«‹ä¸”ä¸å¯å˜çš„ï¼Œéœ€è¦é€šè¿‡æ„é€ å‡½æ•°ä¸€æ¬¡æ€§åœ°è·å¾—æ‰€æœ‰å¿…è¦çš„æ•°æ®ã€‚
4. **å®¢æˆ·ç«¯**ï¼ˆClientï¼‰å¯æ ¹æ®ç¨‹åºé€»è¾‘ä¸€æ¬¡æ€§æˆ–è€…åŠ¨æ€ç”Ÿæˆé“¾ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¯·æ±‚å¯ä»¥å‘é€ç»™é“¾ä¸Šçš„ä»»æ„ä¸€ä¸ªå¤„ç†è€…ï¼Œè€Œéå¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªå¤„ç†è€…ã€‚

## 6. ğŸš€æ¡ˆä¾‹

**è¿‡æ»¤è®¿é—®**ã€‚æœ¬ä¾‹å±•ç¤ºäº†åŒ…å«ç”¨æˆ·æ•°æ®çš„è¯·æ±‚å¦‚ä½•ä¾æ¬¡é€šè¿‡å¤„ç†è€…é“¾æ¥æ‰§è¡Œå„ç§ä¸åŒçš„è¡Œä¸ºï¼ˆä¾‹å¦‚è®¤è¯ã€æˆæƒä¸éªŒè¯ï¼‰ã€‚  
ç»å¤§éƒ¨åˆ†æ¨¡å¼ç¤ºä¾‹éƒ½ä¼šå¯»æ‰¾æ­£ç¡®çš„å¤„ç†è€…ï¼Œå¹¶åœ¨å¤„ç†åé€€å‡ºé“¾ã€‚ä½†åœ¨è¿™é‡Œæˆ‘ä»¬ä¼šæ‰§è¡Œæ¯ä¸ªå¤„ç†è€…ï¼Œç›´è‡³æŸä¸ªå¤„ç†è€… **æ— æ³•å¤„ç†** è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡æµç¨‹ç•¥æœ‰ä¸åŒï¼Œä½†è¿™ä»»æ˜¯è´£ä»»é“¾æ¨¡å¼ã€‚

### 6.1. åŸºç¡€éªŒè¯æ¥å£

```java
public abstract class Middleware {
    private Middleware next;

    /**
     * Subclasses will implement this method with concrete checks.
     */
    protected abstract boolean check(String email, String password);

    /**
     * Runs check on the next object in chain or ends traversing if we're in
     * last object in chain.
     */
    protected boolean checkNext(String email, String password) {
        if (next == null) {
            return true;
        }
        return next.check(email, password);
    }

    public static class Builder {
        private Middleware head;
        private Middleware tail;

        public Builder addMiddleware(Middleware middleware) {
            if (this.head == null) {
                this.head = this.tail = middleware;
                return this;
            }
            this.tail.next = middleware;
            this.tail = middleware;
            return this;
        }

        public Middleware build() {
            return this.head;
        }
    }
}
```

### 6.2. æ£€æŸ¥è¯·æ±‚æ•°é‡é™åˆ¶

```java
public class ThrottlingMiddleware extends Middleware {
    private static final Logger LOGGER = LoggerFactory.getLogger(ThrottlingMiddleware.class);
    private final int requestPerMinute;
    private long currentTime;
    private int request;

    public ThrottlingMiddleware(int requestPerMinute) {
        this.requestPerMinute = requestPerMinute;
        this.currentTime = System.currentTimeMillis();
    }

    /**
     * Please, not that checkNext() call can be inserted both in the beginning
     * of this method and in the end.
     * <p>
     * This gives much more flexibility than a simple loop over all middleware
     * objects. For instance, an element of a chain can change the order of
     * checks by running its check after all other checks.
     */
    @Override
    protected boolean check(String email, String password) {
        if (System.currentTimeMillis() > currentTime + 60_000) {
            request = 0;
            currentTime = System.currentTimeMillis();
        }
        request++;
        if (request > requestPerMinute) {
            LOGGER.debug("Request limit exceeded!");
            Thread.currentThread().stop();
        }
        return checkNext(email, password);
    }
}
```

### 6.3. æ£€æŸ¥ç”¨æˆ·ç™»å½•ä¿¡æ¯

```java
public class UserExistsMiddleware extends Middleware {
    private static final Logger LOGGER = LoggerFactory.getLogger(UserExistsMiddleware.class);

    private final Server server;

    public UserExistsMiddleware(Server server) {
        this.server = server;
    }

    @Override
    protected boolean check(String email, String password) {
        if (!server.hasEmail(email)) {
            LOGGER.debug("This email is not registered!");
            return false;
        }
        if (!server.isValidPassword(email, password)) {
            LOGGER.debug("Wrong password!");
            return false;
        }
        return checkNext(email, password);
    }
}
```

### 6.4. æ£€æŸ¥ç”¨æˆ·è§’è‰²

```java
public class RoleCheckMiddleware extends Middleware {
    private static final Logger LOGGER = LoggerFactory.getLogger(RoleCheckMiddleware.class);

    @Override
    protected boolean check(String email, String password) {
        if (email.equals("admin@example.com")) {
            LOGGER.debug("Hello admin!");
            return true;
        }
        LOGGER.debug("Hello user!");
        return checkNext(email, password);
    }
}
```

### 6.5. æˆæƒç›®æ ‡

```java
public class Server {
    private static final Logger LOGGER = LoggerFactory.getLogger(Server.class);
    private final Map<String, String> users = new HashMap<>();
    private Middleware middleware;

    /**
     * Client passes a chain of object to server. This improves flexibility and
     * makes testing the server class easier.
     */
    public void setMiddleware(Middleware middleware) {
        this.middleware = middleware;
    }

    /**
     * Server gets email and password from client and sends the authorization
     * request to the chain.
     */
    public boolean login(String email, String password) {
        if (middleware.check(email, password)) {
            LOGGER.debug("Authorization have been successful!");
            // Do something useful here for authorized users.
            return true;
        }
        return false;
    }

    public void register(String email, String password) {
        users.put(email, password);
    }

    public boolean hasEmail(String email) {
        return users.containsKey(email);
    }

    public boolean isValidPassword(String email, String password) {
        return users.get(email).equals(password);
    }
}
```

### 6.6. æµ‹è¯•ç±»

```java
public class ApiTest {
    private static final Logger LOGGER = LoggerFactory.getLogger(ApiTest.class);
    private static final BufferedReader reader = new BufferedReader(new InputStreamReader(System.in));
    private static Server server;

    private static void init() {
        server = new Server();
        server.register("admin@example.com", "admin_pass");
        server.register("user@example.com", "user_pass");

        // All checks are linked. Client can build various chains using the same components.
        Middleware middleware = new Builder().addMiddleware(new ThrottlingMiddleware(2))
                .addMiddleware(new UserExistsMiddleware(server))
                .addMiddleware(new RoleCheckMiddleware()).build();
        server.setMiddleware(middleware);
    }

    public static void main(String[] args) throws IOException {
        init();

        boolean success;
        do {
            LOGGER.debug("Enter emailï¼š");
            String email = reader.readLine();
            LOGGER.debug("Enter passwordï¼š");
            String password = reader.readLine();
            success = server.login(email, password);
        } while (!success);
    }
}
```

æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š  
![](https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/202211132359557.png)

## 7. ğŸ‰åº”ç”¨åœºæ™¯

ğŸ **å½“ç¨‹åºä¸­éœ€è¦ä½¿ç”¨ä¸åŒæ–¹å¼å¤„ç†ä¸åŒç§ç±»è¯·æ±‚ï¼Œè€Œä¸”è¯·æ±‚ç±»å‹å’Œé¡ºåºé¢„å…ˆæœªçŸ¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼**ã€‚  
âš¡ è¯¥æ¨¡å¼èƒ½å°†å¤šä¸ªå¤„ç†è€…è¿æ¥æˆä¸€æ¡é“¾ï¼Œæ¥æ”¶åˆ°è¯·æ±‚åï¼Œå®ƒä¼š " è¯¢é—® " æ¯ä¸ªå¤„ç†è€…æ˜¯å¦èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚è¿™æ ·æ‰€æœ‰å¤„ç†è€…éƒ½æœ‰æœºä¼šæ¥å¤„ç†è¯·æ±‚ã€‚

---

ğŸ **å½“å¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªå¤„ç†è€…æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ¨¡å¼**ã€‚  
âš¡ æ— è®ºä½ ä»¥ä½•ç§é¡ºåºå°†å¤„ç†è€…è¿æ¥æˆä¸€æ¡é“¾ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šä¸¥æ ¼æŒ‰ç…§é¡ºåºé€šè¿‡é“¾ä¸Šçš„å¤„ç†è€…ã€‚

---

ğŸ **å¦‚æœæ‰€éœ€å¤„ç†è€…åŠå…¶é¡ºåºå¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œæ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼**ã€‚  
âš¡ å¦‚æœåœ¨å¤„ç†è€…ä¸­æœ‰å¯¹å¼•ç”¨æˆå‘˜å˜é‡çš„è®¾å®šæ–¹æ³•ï¼Œä½ å°±èƒ½åŠ¨æ€åœ°æ’å…¥å’Œç§»é™¤å¤„ç†è€…ï¼Œæˆ–è€…æ”¹å˜å…¶é¡ºåºã€‚

## 8. ğŸ“å®ç°æ–¹å¼

1. å£°æ˜å¤„ç†è€…æ¥å£å¹¶æè¿°è¯·æ±‚å¤„ç†æ–¹æ³•çš„ç­¾åã€‚ç¡®å®šå®¢æˆ·ç«¯å¦‚ä½•å°†è¯·æ±‚æ•°æ®ä¼ é€’ç»™æ–¹æ³•ã€‚æœ€çµæ´»çš„æ–¹å¼å°±æ˜¯å°†è¯·æ±‚è½¬æ¢ä¸ºå¯¹è±¡ï¼Œç„¶åå°†å…¶ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’ç»™å¤„ç†å‡½æ•°ã€‚
2. ä¸ºäº†åœ¨å…·ä½“å¤„ç†è€…ä¸­æ¶ˆé™¤é‡å¤çš„æ ·æœ¬ä»£ç ï¼Œä½ å¯ä»¥æ ¹æ®å¤„ç†è€…æ¥å£åˆ›å»ºæŠ½è±¡å¤„ç†è€…åŸºç±»ã€‚è¯¥ç±»éœ€è¦æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡æ¥å­˜å‚¨æŒ‡å‘é“¾ä¸Šä¸‹ä¸ªå¤„ç†è€…çš„å¼•ç”¨ã€‚å¦‚æœä½ æ‰“ç®—åœ¨è¿è¡Œæ—¶å¯¹é“¾è¿›è¡Œæ”¹å˜ï¼Œåˆ™éœ€è¦å®šä¹‰ä¸€ä¸ªè®¾å®šæ–¹æ³•æ¥ä¿®æ”¹å¼•ç”¨æˆå‘˜å˜é‡çš„å€¼ã€‚
3. ä¾æ¬¡åˆ›å»ºå…·ä½“å¤„ç†è€…å­ç±»å¹¶å®ç°å…¶å¤„ç†æ–¹æ³•ã€‚æ¯ä¸ªå¤„ç†è€…åœ¨æ¥æ”¶åˆ°è¯·æ±‚åéƒ½å¿…é¡»åšå‡ºä¸¤ä¸ªå†³å®šï¼š
	- æ˜¯å¦è‡ªå®šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚
	- æ˜¯å¦å°†è¯¥è¯·æ±‚æ²¿ç€é“¾è¿›è¡Œä¼ é€’ã€‚
4. å®¢æˆ·ç«¯å¯ä»¥è‡ªè¡Œç»„è£…é“¾ï¼Œæˆ–è€…ä»å…¶ä»–å¯¹è±¡å¤„è·å¾—é¢„å…ˆç»„è£…å·çš„é“¾ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»å®ç°å·¥å‚ç±»ä»¥æ ¹æ®é…ç½®æˆ–ç¯å¢ƒè®¾ç½®æ¥åˆ›å»ºã€‚
5. å®¢æˆ·ç«¯å¯ä»¥è§¦å‘é“¾ä¸­çš„ä»»æ„å¤„ç†è€…ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€ä¸ªã€‚è¯·æ±‚å°†é€šè¿‡é“¾è¿›è¡Œä¼ é€’ï¼Œç›´è‡³æŸä¸ªå¤„ç†è€…æ‹’ç»ç»§ç»­ä¼ é€’ï¼Œæˆ–è€…è¯·æ±‚è¾¾åˆ°é“¾å°¾ã€‚
6. ç”±äºé“¾çš„åŠ¨æ€æ€§ï¼Œå®¢æˆ·ç«¯éœ€è¦æœ±å®‰å¤‡å¥½å¤„ç†ä»¥ä¸‹æƒ…å†µï¼š
	- é“¾ä¸­å¯èƒ½åªæœ‰å•ä¸ªå•ä¸ªé“¾æ¥ã€‚
	- éƒ¨åˆ†è¯·æ±‚å¯èƒ½æ— æ³•è¾¾åˆ°é“¾å°¾ã€‚
	- å…¶ä»–è¯·æ±‚å¯èƒ½çŸ¥é“é“¾å°¾éƒ½æœªè¢«å¤„ç†ã€‚

## 9. âš–ï¸ä¼˜ç¼ºç‚¹

- âœ”ï¸ ä½ å¯ä»¥æ§åˆ¶è¯·æ±‚å¤„ç†çš„é¡ºåºã€‚
- âœ”ï¸ **å•ä¸€èŒè´£åŸåˆ™**ã€‚Â ä½ å¯å¯¹å‘èµ·æ“ä½œå’Œæ‰§è¡Œæ“ä½œçš„ç±»è¿›è¡Œè§£è€¦ã€‚
- âœ”ï¸ **å¼€é—­åŸåˆ™**ã€‚Â ä½ å¯ä»¥åœ¨ä¸æ›´æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹åœ¨ç¨‹åºä¸­æ–°å¢å¤„ç†è€…ã€‚
- âŒ éƒ¨åˆ†è¯·æ±‚å¯èƒ½æœªè¢«å¤„ç†
